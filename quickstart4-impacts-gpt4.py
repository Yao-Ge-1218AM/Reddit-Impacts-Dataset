import os
import openai
import json
import time

openai.api_type = "azure"
openai.api_base = "https://sarkerlab-east-us-2.openai.azure.com/"
openai.api_version = "2024-02-15-preview"
openai.api_key = "ebbe6c038a304e4587ebba6f8f2804c9"

#system_message = {"role": "system", "content": "You are a medical AI trained to identify and classify tokens into three categories: Clinical Impacts, Social Impacts, and Outside ('O'), with an understanding of medical concepts from the Unified Medical Language System (UMLS). You understand medical terminology and concepts. The data you are working with has been collected from 14 forums on Reddit (subreddits) that focused on prescription and illicit opioids, and medications for opioid use disorder. This dataset represents a social media context, coming from individuals who may use prescription and illicit opioids and stimulants. In this dataset, high-frequency clinical impacts include 'withdrawal', 'rehab', 'addicted', 'detox', 'overdosed', and 'rehabs'. High-frequency social impacts include 'lost', 'homeless', 'charged', 'streets', 'jail', and 'disorderly'.  Your task is to extract and classify the clinical and social impacts from this dataset, considering your knowledge of the lifestyle of this population and the potential clinical and social impacts they might experience.  'Clinical Impacts' refer to tokens describing the effects, consequences, or impacts of substance use on individual health or well-being, as defined in UMLS. 'Social Impacts' describe the societal, interpersonal, or community-level effects, also based on UMLS definitions. Any token not falling into these categories should be labeled as 'O'. Your task is to predict and return the label for each provided token, ensuring the number of output labels matches the number of input tokens exactly. The output format should be tokens with their labels: ['I-O', 'was-O', 'a-O', 'codeine-Clinical Impacts', 'addict-Clinical Impacts', '.-O']. Please strictly follow the output format to output the results. Please be sure to output each token and its corresponding label, and link them with '-'. When classifying tokens, consider the UMLS concepts and terminology, and the specific context of this social media dataset, to enhance the accuracy of your classifications. Please use the tokens I provided, do not use other tokenization mechanism."

    #}
system_message = {"role": "system", "content": "You are a medical AI trained to identify and classify tokens into three categories: Clinical Impacts, Social Impacts, and Outside ('O'). The data you are working with has been collected from 14 forums on Reddit (subreddits) that focused on prescription and illicit opioids, and medications for opioid use disorder. This dataset represents a social media context, coming from individuals who may use prescription and illicit opioids and stimulants. In this dataset, high-frequency clinical impacts include 'withdrawal', 'rehab', 'addicted', 'detox', 'overdosed', and 'rehabs'. High-frequency social impacts include 'lost', 'homeless', 'charged', 'streets', 'jail', and 'disorderly'.  Your task is to extract and classify the clinical and social impacts from this dataset, considering your knowledge of the lifestyle of this population and the potential clinical and social impacts they might experience.  'Clinical Impacts' refer to tokens describing the effects, consequences, or impacts of substance use on individual health or well-being, as defined in UMLS. 'Social Impacts' describe the societal, interpersonal, or community-level effects, also based on UMLS definitions. Any token not falling into these categories should be labeled as 'O'. Your task is to predict and return the label for each provided token, ensuring the number of output labels matches the number of input tokens exactly. The output format should be tokens with their labels: ['I-O', 'was-O', 'a-O', 'codeine-Clinical Impacts', 'addict-Clinical Impacts', '.-O']. Please strictly follow the output format to output the results. Please be sure to output each token and its corresponding label, and link them with '-'. Please use the tokens I provided, do not use other tokenization mechanism. Possible analysis of prediction errors: If a sentence describes the background information of an event, facility, or project, then even if it mentions keywords related to social impact like 'at jail', it still cannot be determined as describing a patient being in jail. It is essential to clearly determine whether the sentence is describing the patient's condition. Second, if the sentence is about the usage, operation, or introduction of a drug or medicine, it does not belong to the patient's clinical impacts, even if it mentions some symptoms. Pay attention to whether the sentence contains words like 'if' that indicate conditions."}
assistant_message_0u = {"role": "user", "content": "['But', 'by', '11', 'I', 'realized', 'I', 'was', 'actually', 'totally', 'tweaking', 'like', 'never', 'before', '.']"}
assistant_message_0a = {"role": "assistant", "content": "['But-O', 'by-O', '11-O', 'I-O', 'realized-O', 'I-O', 'was-O', 'actually-O', 'totally-O', 'tweaking-Clinical Impacts', 'like-O', 'never-O', 'before-O', '.-O']"}
assistant_message_1u = {"role": "user", "content": "['Im', 'in', 'subs', 'now', 'because', 'I', 'was', 'a', 'codeine', 'addict', '.']"}
assistant_message_1a = {"role": "assistant", "content": "['Im-O', 'in-O', 'subs-O', 'now-O', 'because-O', 'I-O', 'was-O', 'a-O', 'codeine-Clinical Impacts', 'addict-Clinical Impacts', '.-O']"}
assistant_message_2u = {"role": "user", "content": "['I', 'just', 'called', 'a', '1800', 'number', 'and', 'was', 'in', 'a', 'rehab', 'the', 'next', 'day', '.']"}
assistant_message_2a = {"role": "assistant", "content": "['I-Clinical Impacts', 'just-Clinical Impacts', 'called-Clinical Impacts', 'a-Clinical Impacts', '1800-Clinical Impacts', 'number-Clinical Impacts', 'and-Clinical Impacts', 'was-Clinical Impacts', 'in-Clinical Impacts', 'a-Clinical Impacts', 'rehab-Clinical Impacts', 'the-Clinical Impacts', 'next-Clinical Impacts', 'day-Clinical Impacts', '.-O']"}
assistant_message_3u = {"role": "user", "content": "['For', 'me', ',', 'if', 'we', 'can', 'achieve', 'an', 'opium', 'high', 'without', 'the', 'addiction', ',', 'I', 'would', 'be', 'so', 'happy']"}
assistant_message_3a = {"role": "assistant", "content": "['For-O', 'me-O', ',-O', 'if-O', 'we-O', 'can-O', 'achieve-O', 'an-O', 'opium-O', 'high-O', 'without-O', 'the-O', 'addiction-Clinical Impacts', ',-O', 'I-O', 'would-O', 'be-O', 'so-O', 'happy-O']"}
assistant_message_4u = {"role": "user", "content": "['Makes', 'the', 'pain', 'tolerable', '.']"}
assistant_message_4a = {"role": "assistant", "content": "['Makes-Clinical Impacts', 'the-Clinical Impacts', 'pain-Clinical Impacts', 'tolerable-Clinical Impacts', '.-Clinical Impacts']"}
assistant_message_5u = {"role": "user", "content": "['They', 'give', 'me', 'energy', 'and', 'make', 'me', 'talkative', '.']"}
assistant_message_5a = {"role": "assistant", "content": "['They-O', 'give-O', 'me-O', 'energy-O', 'and-O', 'make-O', 'me-O', 'alkative-Social Impacts', '.-O']"}
assistant_message_6u = {"role": "user", "content": "['I', 'been', 'in', 'outpatient', 'therapy', 'and', 'on', 'suboxone', 'for', 'nearly', 'ten', 'months', 'now', ',', 'and', 'every', 'day', 'it', 'is', 'more', 'clear', 'to', 'me', 'that', 'the', 'drugs', 'were', 'not', 'killing', 'me', ',', 'loved', 'those', ',', 'but', 'the', 'shame', ',', 'the', 'isolation', 'and', 'the', 'heavy', 'secrets', 'were', '.']"}
assistant_message_6a = {"role": "assistant", "content": "['I-O', 'been-O', 'in-O', 'outpatient-O', 'therapy-O', 'and-O', 'on-O', 'suboxone-O', 'for-O', 'nearly-O', 'ten-O', 'months-O', 'now-O', ',-O', 'and-O', 'every-O', 'day-O', 'it-O', 'is-O', 'more-O', 'clear-O', 'to-O', 'me-O', 'that-O', 'the-O', 'drugs-O', 'were-O', 'not-O', 'killing-O', 'me-O', ',-O', 'loved-O', 'those-O', ',-O', 'but-Social Impacts', 'the-Social Impacts', 'shame-Social Impacts', ',-Social Impacts', 'the-Social Impacts', 'isolation-Social Impacts', 'and-Social Impacts', 'the-Social Impacts', 'heavy-Social Impacts', 'secrets-Social Impacts', 'were-Social Impacts', '.-Social Impacts']"}
assistant_message_7u = {"role": "user", "content": "['A', 'long', 'time', 'ago', 'I', 'once', 'had', 'blacked', 'out', 'for', 'basically', 'a', 'couple', ',', 'few', 'days', 'and', 'I', 'wake', 'up', 'one', 'day', 'to', 'a', 'call', 'and', 'when', 'I', 'answer', 'the', 'guy', 'says', ',', 'Hi', ',', 'name', ',', ',', 'was', 'it', 'today', 'you', 'were', 'planing', 'on', 'starting', '?', '!']"}
assistant_message_7a = {"role": "assistant", "content": "['A-Social Impacts', 'long-Social Impacts', 'time-Social Impacts', 'ago-Social Impacts', 'I-Social Impacts', 'once-Social Impacts', 'had-Social Impacts', 'blacked-Social Impacts', 'out-Social Impacts', 'for-Social Impacts', 'basically-Social Impacts', 'a-Social Impacts', 'couple-Social Impacts', ',-Social Impacts', 'few-Social Impacts', 'days-Social Impacts', 'and-O', 'I-O', 'wake-O', 'up-O', 'one-O', 'day-O', 'to-O', 'a-O', 'call-O', 'and-O', 'when-O', 'I-O', 'answer-O', 'the-O', 'guy-O', 'says-O', ',-O', 'Hi-O', ',-O', 'name-O', ',-O', ',-O', 'was-O', 'it-O', 'today-O', 'you-O', 'were-O', 'planning-O', 'on-O', 'study-O', '?-O', '!-O']"}
assistant_message_8u = {"role": "user", "content": "['I', 'was', 'worried', 'I', 'lose', 'my', 'job', 'because', 'I', 'be', 'unable', 'to', 'function', 'for', 'a', 'wee', '.']"}
assistant_message_8a = {"role": "assistant", "content": "['I-Social Impacts', 'was-Social Impacts', 'worried-Social Impacts', 'I-Social Impacts', 'lose-Social Impacts', 'my-Social Impacts', 'job-Social Impacts', 'because-Social Impacts', 'I-Social Impacts', 'been-Social Impacts', 'unable-Social Impacts', 'to-Social Impacts', 'function-Social Impacts', 'for-Social Impacts', 'a-Social Impacts', 'wee-Social Impacts', '.-O']"}
assistant_message_9u = {"role": "user", "content": "['Her', 'husband', 'would', 'call', 'me', 'asking', 'if', 'I', 'had', 'seen', 'her', 'because', 'she', 'hadnt', 'been', 'home', 'for', 'days', '.']"}
assistant_message_9a = {"role": "assistant", "content": "['Her-O', 'husband-O', 'would-O', 'call-O', 'me-O', 'asking-O', 'if-O', 'I-O', 'had-O', 'seen-O', 'her-O', 'because-O', 'she-Social Impacts', 'hadnt-Social Impacts', 'been-Social Impacts', 'home-Social Impacts', 'for-Social Impacts', 'Social Impacts', 'days-Social Impacts', '.-O']"}


assistant_message_10u = {"role": "user", "content": "['Because', 'it', 'was', 'fake', ',', 'as', 'in', 'no', 'drugs', 'in', 'it', ',', 'I', 'withdrew', 'really', 'bad', '(', 'as', 'in', 'I', 'know', 'what', 'hell', 'is', ')', 'the', 'whole', 'week', 'family', 'was', 'in', 'town', '.']"}
assistant_message_10a = {"role": "assistant", "content": "['Because-O', 'it-O', 'was-O', 'fake-O', ',-O', 'as-O', 'in-O', 'no-O', 'drugs-O', 'in-O', 'it-O', ',-O', 'I-O', 'withdrew-Clinical Impacts', 'really-O', 'bad-O', '(-O', 'as-O', 'in-O', 'I-O', 'know-O', 'what-O', 'hell-O', 'is-O', ')-O', 'the-O', 'whole-O', 'week-O', 'family-O', 'was-O', 'in-O', 'town-O', '.-O']"}
assistant_message_11u = {"role": "user", "content": "['I', 'was', 'an', 'OTC', 'codeine', 'addict', 'myself', 'before', 'starting', 'on', 'Buprenorphine', 'maintenance']"}
assistant_message_11a = {"role": "assistant", "content": "['I-O', 'was-O', 'an-O', 'OTC-O', 'codeine-Clinical Impacts', 'addict-Clinical Impacts', 'myself-O', 'before-O', 'starting-O', 'on-O', 'Buprenorphine-O', 'maintenance-O']"}
assistant_message_12u = {"role": "user", "content": "['In', 'PA', 'at', 'a', '28', 'day', 'detox', '/', 'rehab', 'they', 'used', 'methadone', 'to', 'get', 'me', 'off', 'of', 'bupe', '.']"}
assistant_message_12a = {"role": "assistant", "content": "['In-O', 'PA-O', 'at-Clinical Impacts', 'a-Clinical Impacts', '28-Clinical Impacts', 'day-Clinical Impacts', 'detox-Clinical Impacts', '/-Clinical Impacts', 'rehab-Clinical Impacts', 'they-O', 'used-O', 'methadone-O', 'to-O', 'get-O', 'me-O', 'off-O', 'of-O', 'bupe-O', '.-O']"}
assistant_message_13u = {"role": "user", "content": "['Then', 'one', 'overdoses', 'and', 'dies', 'because', 'their', 'parents', 'got', 'a', 'divorce', 'when', 'the', 'husband', 'got', 'caught', 'cheating', 'with', 'trannys', 'instead', 'of']"}
assistant_message_13a = {"role": "assistant", "content": "['Then-O', 'one-O', 'overdoses-Clinical Impacts', 'and-Clinical Impacts', 'dies-Clinical Impacts', 'because-O', 'their-O', 'parents-O', 'got-O', 'a-O', 'divorce-O', 'when-O', 'the-O', 'husband-O', 'got-O', 'caught-O', 'cheating-O', 'with-O', 'trannys-O', 'instead-O', 'of-O']"}
assistant_message_14u = {"role": "user", "content": "['Truth', 'is', ',', 'I', 'was', 'in', 'the', 'psych', 'ward', 'from', 'Tuesday', 'afternoon', 'until', 'this', 'evening', '.']"}
assistant_message_14a = {"role": "assistant", "content": "['Truth-O', 'is-O', ',-O', 'I-O', 'was-O', 'in-O', 'the-O', 'psych-Clinical Impacts', 'ward-Clinical Impacts', 'from-O', 'Tuesday-O', 'afternoon-O', 'until-O', 'this-O', 'evening-O', '.-O']"}
assistant_message_15u = {"role": "user", "content": "['Outpatient', 'and', 'MAT', 'is', 'how', 'I', 'got', 'clean', ',', 'she', 'has', 'to', 'want', 'it', 'tho', ',', 'as', 'the', 'saying', 'goes', '.']"}
assistant_message_15a = {"role": "assistant", "content": "['Outpatient-Clinical Impacts', 'and-O', 'MAT-O', 'is-O', 'how-O', 'I-O', 'got-O', 'clean-O', ',-O', 'she-O', 'has-O', 'to-O', 'want-O', 'it-O', 'tho-O', ',-O', 'as-O', 'the-O', 'saying-O', 'goes-O', '.-O']"}
assistant_message_16u = {"role": "user", "content": "['I', 'hope', 'you', 'choose', 'to', 'stay', 'clean', 'because', 'it', 'is', 'absolutely', 'NOT', 'worth', 'going', 'back', 'to', 'that', 'hell', 'that', 'I', 'just', 'pulled', 'myself', 'out', 'of', 'after', '20', 'years', 'of', 'being', 'a', 'worthless', 'scumbag', '.']"}
assistant_message_16a = {"role": "assistant", "content": "['I-Social Impacts', 'hope-Social Impacts', 'you-Social Impacts', 'choose-Social Impacts', 'to-Social Impacts', 'stay-Social Impacts', 'clean-Social Impacts', 'because-Social Impacts', 'it-Social Impacts', 'is-Social Impacts', 'absolutely-Social Impacts', 'NOT-Social Impacts', 'worth-Social Impacts', 'going-Social Impacts', 'back-Social Impacts', 'to-Social Impacts', 'that-Social Impacts', 'hell-Social Impacts', 'that-Social Impacts', 'I-Social Impacts', 'just-Social Impacts', 'pulled-Social Impacts', 'myself-Social Impacts', 'out-Social Impacts', 'of-Social Impacts', 'after-Social Impacts', '20-Social Impacts', 'years-Social Impacts', 'of-Social Impacts', 'being-Social Impacts', 'a-Social Impacts', 'worthless-Social Impacts', 'scumbag-Social Impacts', '.-O']"}
assistant_message_17u = {"role": "user", "content": "['I', 'was', 'a', 'homeless', 'junkie', 'on', 'the', 'streets', 'of', 'Florida', '.']"}
assistant_message_17a = {"role": "assistant", "content": "['I-Social Impacts', 'was-Social Impacts', 'a-Social Impacts', 'homeless-Social Impacts', 'junkie-Social Impacts', 'on-Social Impacts', 'the-Social Impacts', 'streets-Social Impacts', 'of-O', 'Florida-O', '.-O']"}
assistant_message_18u = {"role": "user", "content": "['We', 'lost', 'everything', 'during', 'our', 'drug', 'use', 'before', 'we', 'met', 'each', 'other', 'and', 'after', '.']"}
assistant_message_18a = {"role": "assistant", "content": "['We-Social Impacts', 'lost-Social Impacts', 'everything-Social Impacts', 'during-Social Impacts', 'our-Social Impacts', 'drug-Social Impacts', 'use-Social Impacts', 'before-Social Impacts', 'we-Social Impacts', 'met-Social Impacts', 'each-Social Impacts', 'other-Social Impacts', 'and-Social Impacts', 'after-Social Impacts', '.-Social Impacts']"}
assistant_message_19u = {"role": "user", "content": "['I', 'was', 'so', 'brainwashed', 'by', 'that', 'hell', 'hole', '.']"}
assistant_message_19a = {"role": "assistant", "content": "['I-Social Impacts', 'was-Social Impacts', 'so-Social Impacts', 'brainwashed-Social Impacts', 'by-Social Impacts', 'that-Social Impacts', 'hell-Social Impacts', 'hole-Social Impacts', '.-Social Impacts']"}
assistant_message_20u = {"role": "user", "content": "['I', 'am', 'a', 'recovering', 'addict', 'and', 'I', 'overdosed', 'at', '19', '(', 'I', '’', 'm', '25', 'now', ')', 'and', 'I', 'was', 'charged', 'with', 'disorderly', 'conduct', '(', 'only', 'thing', 'on', 'my', 'record', ')', '.']"}
assistant_message_20a = {"role": "assistant", "content": "['I-Clinical Impacts', 'am-Clinical Impacts', 'a-Clinical Impacts', 'recovering-Clinical Impacts', 'addict-Clinical Impacts', 'and-Clinical Impacts', 'I-Clinical Impacts', 'overdosed-Clinical Impacts', 'at-Clinical Impacts', '19-Clinical Impacts', '(-Clinical Impacts', 'I-Clinical Impacts', '’-Clinical Impacts', 'm-Clinical Impacts', '25-Clinical Impacts', 'now-Clinical Impacts', ')-Clinical Impacts', 'and-O', 'I-Social Impacts', 'was-Social Impacts', 'charged-Social Impacts', 'with-Social Impacts', 'disorderly-Social Impacts', 'conduct-Social Impacts', '(-Social Impacts', 'only-Social Impacts', 'thing-Social Impacts', 'on-Social Impacts', 'my-Social Impacts', 'record-Social Impacts', ')-Social Impacts', '.-O']"}

assistant_message_21u = {"role": "user", "content": "['Addiction', 'is', 'fucking', 'hard', '.']"}
assistant_message_21a = {"role": "assistant", "content": "['Addiction-Clinical Impacts', 'is-O', 'fucking-O', 'hard-O', '.-O']"}
assistant_message_22u = {"role": "user", "content": "['I', 'have', 'cotton', 'mouth', 'and', 'I', 'feel', 'really', 'weird', '.']"}
assistant_message_22a = {"role": "assistant", "content": "['I-O', 'have-O', 'cotton-Clinical Impacts', 'mouth-Clinical Impacts', 'and-O', 'I-O', 'feel-O', 'really-O', 'weird-O', '.-O']"}
assistant_message_23u = {"role": "user", "content": "['But', 'i', 'felt', 'chills', 'while', 'i', 'was', 'sweating', 'my', 'balls', 'off', '.']"}
assistant_message_23a = {"role": "assistant", "content": "['But-Clinical Impacts', 'i-Clinical Impacts', 'felt-Clinical Impacts', 'chills-Clinical Impacts', 'while-Clinical Impacts', 'i-Clinical Impacts', 'was-Clinical Impacts', 'sweating-Clinical Impacts', 'my-Clinical Impacts', 'balls-Clinical Impacts', 'off-Clinical Impacts', '.-O']"}
assistant_message_24u = {"role": "user", "content": "['This', 'reminds', 'me', 'so', 'much', 'of', 'how', 'I', 'felt', 'my', 'first', 'week', 'in', 'rehab', '.']"}
assistant_message_24a = {"role": "assistant", "content": "['This-Clinical Impacts', 'reminds-Clinical Impacts', 'me-Clinical Impacts', 'so-Clinical Impacts', 'much-Clinical Impacts', 'of-Clinical Impacts', 'how-Clinical Impacts', 'I-Clinical Impacts', 'felt-Clinical Impacts', 'my-Clinical Impacts', 'first-Clinical Impacts', 'week-Clinical Impacts', 'in-Clinical Impacts', 'rehab-Clinical Impacts', '.-Clinical Impacts']"}
assistant_message_25u = {"role": "user", "content": "['I', 'lost', 'a', 'pregnancy', 'when', 'I', 'went', 'cold', 'turkey', 'and', 'my', 'doctor', 'told', 'me', 'this', 'was', 'a', 'possible', 'reason', 'why', '.']"}
assistant_message_25a = {"role": "assistant", "content": "['I-O', 'lost-Clinical Impacts', 'a-Clinical Impacts', 'pregnancy-Clinical Impacts', 'when-O', 'I-O', 'went-O', 'cold-O', 'turkey-O', 'and-O', 'my-O', 'doctor-O', 'told-O', 'me-O', 'this-O', 'was-O', 'a-O', 'possible-O', 'reason-O', 'why-O', '.-O']"}
assistant_message_26u = {"role": "user", "content": "['I', 'started', 'using', 'and', 'I', 'changed', 'and', 'became', 'a', 'different', 'person', '.']"}
assistant_message_26a = {"role": "assistant", "content": "['I-Social Impacts', 'started-Social Impacts', 'using-Social Impacts', 'and-Social Impacts', 'I-Social Impacts', 'changed-Social Impacts', 'and-Social Impacts', 'became-Social Impacts', 'a-Social Impacts', 'different-Social Impacts', 'person-Social Impacts', '.-O']"}
assistant_message_27u = {"role": "user", "content": "['Im', 'on', 'probation', ',', 'and', 'Im', 'on', 'suboxone', ',', 'but', 'they', 'dont', 'know', ',', 'cause', 'I', 'have', 'never', 'told', 'them', ',', 'nor', 'do', 'I', 'intend', 'to']"}
assistant_message_27a = {"role": "assistant", "content": "['Im-O', 'on-O', 'probation-Social Impacts', ',-O', 'and-O', 'Im-O', 'on-O', 'suboxone-O', ',-O', 'but-O', 'they-O', 'dont-O', 'know-O', ',-O', 'cause-O', 'I-O', 'have-O', 'never-O', 'told-O', 'them-O', ',-O', 'nor-O', 'do-O', 'I-O', 'intend-O', 'to-O']"}
assistant_message_28u = {"role": "user", "content": "['Her', 'husband', 'would', 'call', 'me', 'asking', 'if', 'I', 'had', 'seen', 'her', 'because', 'she', 'hadn', 't', 'been', 'home', 'for', 'days', '.']"}
assistant_message_28a = {"role": "assistant", "content": "['Her-O', 'husband-O', 'would-O', 'call-O', 'me-O', 'asking-O', 'if-O', 'I-O', 'had-O', 'seen-O', 'her-O', 'because-O', 'she-Social Impacts', 'hadn-Social Impacts', 't-Social Impacts', 'been-Social Impacts', 'home-Social Impacts', 'for-Social Impacts', 'days-Social Impacts', '.-O']"}
assistant_message_29u = {"role": "user", "content": "['I', 'have', 'lost', 'friends', ',', 'family', 'members', 'and', 'a', 'lot', 'of', 'people', 'trust', '.']"}
assistant_message_29a = {"role": "assistant", "content": "['I-O', 'have-O', 'lost-Social Impacts', 'friends-Social Impacts', ',-Social Impacts', 'family-Social Impacts', 'members-Social Impacts', 'and-Social Impacts', 'a-Social Impacts', 'lot-Social Impacts', 'of-Social Impacts', 'people-Social Impacts', 'trust-Social Impacts', '.-O']"}
assistant_message_30u = {"role": "user", "content": "['I', 'pretty', 'sure', 'I', 'ruined', 'my', 'life', 'though', 'in', 'all', 'seriousness', 'but', 'I', 'honestly', 'havent', 'smoked', 'a', 'single', 'cigarette', 'this', 'whole', 'time']"}
assistant_message_30a = {"role": "assistant", "content": "['I-Social Impacts', 'pretty-Social Impacts', 'sure-Social Impacts', 'I-Social Impacts', 'ruined-Social Impacts', 'my-Social Impacts', 'life-Social Impacts', 'though-Social Impacts', 'in-Social Impacts', 'all-Social Impacts', 'seriousness-Social Impacts', 'but-O', 'I-O', 'honestly-O', 'havent-O', 'smoked-O', 'a-O', 'single-O', 'cigarette-O', 'this-O', 'whole-O', 'time-O']"}

#assistant_message_21u = {"role": "user", "content": ""}
#assistant_message_21a = {"role": "assistant", "content": ""}

assistant_message_31u = {"role": "user", "content": "['With', 'the', 'help', 'of', 'a', 'friend', ',', 'I', 'scheduled', 'an', 'intake', 'at', 'a', 'clinic', 'to', 'start', 'a', '30', '-', 'day', 'outpatient', 'detox', 'program', 'on', 'Tuesday', '12', '/', '31', '.']"}
assistant_message_31a = {"role": "assistant", "content": "['With-O', 'the-O', 'help-O', 'of-O', 'a-O', 'friend-O', ',-O', 'I-O', 'scheduled-O', 'an-O', 'intake-O', 'at-O', 'a-O', 'clinic-O', 'to-O', 'start-O', 'a-O', '30-Clinical Impacts', '--Clinical Impacts', 'day-Clinical Impacts', 'outpatient-Clinical Impacts', 'detox-Clinical Impacts', 'program-Clinical Impacts', 'on-O', 'Tuesday-O', '12-O', '/-O', '31-O', '.-O']"}
assistant_message_32u = {"role": "user", "content": "['Felt', 'hopeless', 'but', 'rehab', 'definitely', 'saved', 'my', 'life', '.']"}
assistant_message_32a = {"role": "assistant", "content": "['Felt-Clinical Impacts', 'hopeless-Clinical Impacts', 'but-Clinical Impacts', 'rehab-Clinical Impacts', 'definitely-Clinical Impacts', 'saved-Clinical Impacts', 'my-Clinical Impacts', 'life-Clinical Impacts', '.-Clinical Impacts']"}
assistant_message_33u = {"role": "user", "content": "['i', 'stayed', 'at', 'fucked', 'up', 'rehabs', 'before', 'Have', 'you', '?']"}
assistant_message_33a = {"role": "assistant", "content": "['i-Clinical Impacts', 'stayed-Clinical Impacts', 'at-Clinical Impacts', 'fucked-Clinical Impacts', 'up-Clinical Impacts', 'rehabs-Clinical Impacts', 'before-Clinical Impacts', 'Have-O', 'you-O', '?-O']"}
assistant_message_34u = {"role": "user", "content": "['killed', 'my', 'stomach', '.']"}
assistant_message_34a = {"role": "assistant", "content": "['killed-Clinical Impacts', 'my-Clinical Impacts', 'stomach-Clinical Impacts', '.-O']"}
assistant_message_35u = {"role": "user", "content": "['In', 'May', 'of', '2018', ',', 'I', 'spent', 'three', 'weeks', 'using', 'my', 'drug', 'of', 'choice', '(', 'IV', 'heroin', ')', 'before', 'going', 'to', 'a', 'partial', 'hospitalization', 'program', 'for', 'treatment', '.']"}
assistant_message_35a = {"role": "assistant", "content": "['In-O', 'May-O', 'of-O', '2018-O', ',-O', 'I-O', 'spent-O', 'three-O', 'weeks-O', 'using-O', 'my-O', 'drug-O', 'of-O', 'choice-O', '(-O', 'IV-O', 'heroin-O', ')-O', 'before-O', 'going-O', 'to-O', 'a-O', 'partial-Clinical Impacts', 'hospitalization-Clinical Impacts', 'program-Clinical Impacts', 'for-Clinical Impacts', 'treatment-Clinical Impacts', '.-O']"}
assistant_message_36u = {"role": "user", "content": "['Til', 'I', 'had', 'blown', 'my', 'very', 'last', 'dollar', '.']"}
assistant_message_36a = {"role": "assistant", "content": "['Til-Social Impacts', 'I-Social Impacts', 'had-Social Impacts', 'blown-Social Impacts', 'my-Social Impacts', 'very-Social Impacts', 'last-Social Impacts', 'dollar-Social Impacts', '.-O']"}
assistant_message_37u = {"role": "user", "content": "['I', 'had', 'been', 'with', 'my', 'then', 'bf', 'for', 'over', '6', 'years', 'and', 'we', 'had', 'developed', 'a', 'nasty', 'drug', 'habit', 'resulting', 'in', 'losing', 'car', ',', 'home', ',', 'and', 'possessions', '.']"}
assistant_message_37a = {"role": "assistant", "content": "['I-O', 'had-O', 'been-O', 'with-O', 'my-O', 'then-O', 'bf-O', 'for-O', 'over-O', '6-O', 'years-O', 'and-O', 'we-O', 'had-O', 'developed-O', 'a-O', 'nasty-O', 'drug-O', 'habit-O', 'resulting-O', 'in-O', 'losing-Social Impacts', 'car-Social Impacts', ',-Social Impacts', 'home-Social Impacts', ',-Social Impacts', 'and-Social Impacts', 'possessions-Social Impacts', '.-Social Impacts']"}
assistant_message_38u = {"role": "user", "content": "['I', 'was', 'homeless', 'like', '4', 'months', 'ago', '.']"}
assistant_message_38a = {"role": "assistant", "content": "['I-Social Impacts', 'was-Social Impacts', 'homeless-Social Impacts', 'like-Social Impacts', '4-Social Impacts', 'months-Social Impacts', 'ago-Social Impacts', '.-Social Impacts']"}
assistant_message_39u = {"role": "user", "content": "['And', 'I', 'never', 'thought', 'I', 'would', 'live', 'to', 'see', '40', ',', 'but', 'here', 'I', 'am', '39', 'and', 'going', 'strong', '.']"}
assistant_message_39a = {"role": "assistant", "content": "['And-Social Impacts', 'I-Social Impacts', 'never-Social Impacts', 'thought-Social Impacts', 'I-Social Impacts', 'would-Social Impacts', 'live-Social Impacts', 'to-Social Impacts', 'see-Social Impacts', '40-Social Impacts', ',-Social Impacts', 'but-Social Impacts', 'here-Social Impacts', 'I-Social Impacts', 'am-Social Impacts', '39-Social Impacts', 'and-Social Impacts', 'going-Social Impacts', 'strong-Social Impacts', '.-Social Impacts']"}
#assistant_message_40u = {"role": "user", "content": "['Because', 'of', 'this', 'situation', ',', 'I', 'lost', 'my', 'best', 'friend', '.']"}
#assistant_message_40a = {"role": "assistant", "content": "['Because-O', 'of-O', 'this-O', 'situation-O', ',-O', 'I-Social Impacts', 'lost-Social Impacts', 'my-Social Impacts', 'best-Social Impacts', 'friend-Social Impacts', '.-O'"}


file_path = '/Users/yaoge/Downloads/test_texts8.txt'

# Read each line from the file and make an API call
with open(file_path, 'r', encoding='utf-8') as file:
    for line in file:
        # Strip newline characters from the end of the line
        line = line.strip()
        
        # Skip empty lines
        if not line:
            continue
        
        # Create a new user message with the current line
        user_message = {"role": "user", "content": line}
        
        # Construct messages for the current iteration
        messages = [system_message, assistant_message_0u, assistant_message_0a, assistant_message_1u, assistant_message_1a, assistant_message_2u, assistant_message_2a, assistant_message_3u, assistant_message_3a, assistant_message_4u, assistant_message_4a, assistant_message_5u, assistant_message_5a, assistant_message_6u, assistant_message_6a, assistant_message_7u, assistant_message_7a, assistant_message_8u, assistant_message_8a, assistant_message_9u, assistant_message_9a, assistant_message_10u, assistant_message_10a, 
        assistant_message_11u, assistant_message_11a, assistant_message_12u, assistant_message_12a, assistant_message_13u, assistant_message_13a, assistant_message_14u, assistant_message_14a, assistant_message_15u, assistant_message_15a, assistant_message_16u, assistant_message_16a, assistant_message_17u, assistant_message_17a, assistant_message_18u, assistant_message_18a, assistant_message_19u, assistant_message_19a, assistant_message_20u, assistant_message_20a, 
        assistant_message_21u, assistant_message_21a, assistant_message_22u, assistant_message_22a, assistant_message_23u, assistant_message_23a, assistant_message_24u, assistant_message_24a, assistant_message_25u, assistant_message_25a, assistant_message_26u, assistant_message_26a, assistant_message_27u, assistant_message_27a, assistant_message_28u, assistant_message_28a, assistant_message_29u, assistant_message_29a, assistant_message_30u, assistant_message_30a,
        assistant_message_31u, assistant_message_31a, assistant_message_32u, assistant_message_32a, assistant_message_33u, assistant_message_33a, assistant_message_34u, assistant_message_34a, assistant_message_35u, assistant_message_35a, assistant_message_36u, assistant_message_36a, assistant_message_37u, assistant_message_37a, assistant_message_38u, assistant_message_38a, assistant_message_39u, assistant_message_39a, #assistant_message_40u, assistant_message_40a, 
        user_message]
        #messages = [system_message, user_message]

        # Make the API call
        completion = openai.ChatCompletion.create(
            engine="app0424",
            messages=messages,
            temperature=0.2,
            max_tokens=800,
            top_p=0.1,
            frequency_penalty=0,
            presence_penalty=0,
            stop=None
        )
        
        # Process the response
        with open('/Users/yaoge/Downloads/test_preds_gpt4_20shot-erroranalysis-1.txt','a') as wf:
        	print(user_message)
        	wf.write(completion['choices'][0]['message']['content'])
        #print(completion['choices'][0]['message']['content'])

        # Add a delay if needed to avoid rate limits
        time.sleep(1)


